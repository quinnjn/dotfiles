#!/usr/bin/env python3

import subprocess
import leglight

lights = [leglight.LegLight('192.168.1.166', 9123)]
if (len(lights) < 1):
    print("No lights found. Exiting")
    exit(1)

def camera(active):
    for light in lights:
        if active:
            light.on()
        else:
            light.off()

logStreamCmd = ['log', 'stream', '--predicate', """eventMessage contains 'Frame publisher cameras changed to'"""]
with subprocess.Popen(logStreamCmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True) as proc:
    for line in proc.stdout:
        if ("Frame publisher cameras changed to [:]" in line):
            camera(False)
        elif ('Frame publisher cameras changed to ["' in line):
            camera(True)
